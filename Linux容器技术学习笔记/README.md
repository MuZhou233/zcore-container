学习当前的容器技术主要是为了给zCore容器的实现提供思路，通过容器技术的发展过程可以看出容器技术主要解决的问题和解决的方式

## 容器解决了什么问题

与虚拟机一样能够实现隔离/沙箱。  
容器共用宿主的操作系统内核一方面实现了更高的性能，一方面限制了只能在Linux上工作

## 容器技术的表象是什么样的

关于进程：  
- 以容器内的角度，在容器内的进程就是系统中正在运行的所有进程，这些进程独占了一个物理机或虚拟机（即无法感知到容器宿主）
- 以宿主机的角度：所有容器内和容器外的进程拥有各不相同的PID，受内核管理。容器内的进程还以容器为单位占用资源并受到限制

关于文件：  
一般情况下，每个容器都拥有自己的目录结构，并且挂载点映射到宿主中非常有限且不同的位置，比如几个特定的文件夹中的子文件夹

关于网络：  
一般情况下，每个容器都拥有若干个虚拟网卡和虚拟网桥，用来和其他容器、宿主机通信

## 容器技术的内核基础是什么

### 进程

需要让进程相信自己看到的其他进程就是系统中的全部进程。  

PID namespace 实现在容器外使用内核默认分配的PID，在容器内使用独立分配的PID，使得进程通过PID仅能访问到同容器内的其他进程。  
IPC namespace 实现在进程间通信时与 PID namespace 保持一致，同样只能与同容器的其他进程通信。  

### 文件

一般容器管理器会以某种方式（分层文件）在文件系统中存储各容器的根目录，与其他位置的配置文件目录、日志目录、数据目录等映射组成了容器内看到的目录结构。

Mount namespace 实现了为容器映射宿主目录或设备并生成挂载点信息。  
User namespace 实现了类似于PID的各容器独立的UID和GID。  

### 网络

需要让通过虚拟网桥连接的多个容器中的进程相信自己所处的是一个局域网络中的独立主机。
Network namespace 实现了各容器自己独立的网卡、路由表、ARP 表、iptables 等和网络相关的资源。  
UTS namespace 实现不同容器拥有不同的主机名。使得依赖主机名的多机应用可以正确的互相连接。  

### 资源限制

Linux cgroups 实现了各种资源的限制功能，但目前的开发应该不会涉及资源限制，暂时不深究